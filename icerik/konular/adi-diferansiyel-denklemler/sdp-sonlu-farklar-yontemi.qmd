---
title: "SDP - Sonlu Farklar Yöntemi"
---

## Sonlu Farklar Yöntemi

Sonlu farklar yöntemini kullanarak sınır değer problemine ait diferansiyel denklem çözeceğiz. Bunun için taylor açılımını kullanacağız.

Taylor açılımında birinci türevi orta noktayı kullanarak yazalım.

$$
y'_{i} = \frac{y_{i+1}-y_{i-1}}{2h}
$$

Şimdi $y'_{i}=g_{i}$ gibi bir fonksiyon olsun. Yukarıdaki bağıntı yerine $g_{i}$ koyalım.

$$
g'_{i} = \frac{g_{i+1}-g_{i-1}}{2h}
$$

Biliyoruz ki $g_{i}=y'_{i}$'dir.

$$
y''_{i} = \frac{y'_{i+1}-y'_{i-1}}{2h}
$$

$$
y''_{i} = \frac{1}{2h}\left(\frac{y_{i+2}-y_{i}}{2h}-\frac{y_{i}-y_{i-2}}{2h}\right)
$$

Biraz düzenleyelim.

$$
y''_{i} = \frac{1}{4h^2}\left(y_{i+2}-y_{i}-y_{i}+y_{i-2}\right)
$$

$$
y''_{i} = \frac{y_{i+2}-2y_{i}+y_{i-2}}{4h^2}
$$

Eğer adım aralığını yarıya indirirsek yani $h \rightarrow h/2$ yaparsak $y_{i+2}$ noktasından $y_{i+1}$ noktasına gelebiliriz. Benzer şekilde $y_{i-2}$ noktasından $y_{i-1}$ noktasına geliriz. Bu adım sadece sabit adım aralığı için geçerlidir. O halde ikinci türeve ait olan denklem şöyle olur.

$$
y''_{i} = \frac{y_{i+1}-2y_{i}+y_{i-1}}{h^2}
$$

Bu denklemi kullanarak sınır değer problemlerini çözeceğiz. Yukarıdaki bağıntı, diferansiyel denklemi cebirsel denklem sistemine dönüştürür. 

$$
y''_{i} = f\left(x,y_{i},\frac{y_{i+1}-y_{i-1}}{2h}\right)=\frac{y_{i+1}-2y_{i}+y_{i-1}}{h^2}
$$

## Alıştırma 1

Aşağıdaki denklemi adım adım çözelim.

$$
y''(t)=t, \quad y(0)=1, \quad y(3)=9
$$

### Çözüm

Adım aralığı $h=1$ olsun. $t$'nin değerleri $0, 1, 2, 3$ olacaktır. Bu değerlerden $y$ değerlerini bulalım.

$$
y''(t)=t=\frac{y_{i+1}-2y_{i}+y_{i-1}}{h^2}
$$

Çözüme $y(0)$'dan başlayalım. Bunun için $y(0) \equiv y_{i-1}$ almamız gerekecektir. Aksi taktirde köşe noktalar için denklemi çözemeyiz.

Aşağıdaki tabloyu $h=1$ için yazalım.

| $y_{0}$ | $y_{1}$   | $y_{2}$   | $y_{3}$ |
|----|----|----| ----|
| $y(0)$ | $y(0+h)$   | $y(0+2h)$   | $y(0+3h)$ |
| $y(t=0)$ | $y(t=1)$   | $y(t=2)$   | $y(t=3)$ |
|  1  |  ?  | ?  |  9  |

Örneğin aşağıdaki tabloyu da $h=0.5$ için yazalım.

| $y_{0}$| $y_{1}$  | $y_{2}$   | $y_{3}$   | $y_{4}$   | $y_{5}$   | $y_{6}$   |
|--------|----------|-----------|-----------|-----------|-----------|-----------|
| $y(0)$ | $y(0.5)$ | $y(1)$    | $y(1.5)$  | $y(2)$    | $y(2.5)$  | $y(3)$    |
|  1  |  ?  | ?  | ?  | ?  | ?  |  9  |

Şimdi yukarıdaki elde ettiğimiz denklemi yazalım.

$$
y''(t)=t=\frac{y_{i+1}-2y_{i}+y_{i-1}}{h^2}
$$

$i=1$ olmalı. Bundan dolayı $t$ ilk değil bir sonraki adımından yani $t+h=0+0.5$'den itibaren başlatmalıyız.
$$
0.5 = \frac{y_{2}-2y_{1}+y_{0}}{h^2}
$$

Bu denklemi $h=0.5$ için adım adım yazalım.

$$
0.5\times (0.5)^{2} = y_{2}-2y_{1}+y_{0}\\
1\times (0.5)^{2} = y_{3}-2y_{2}+y_{1}\\
1.5\times (0.5)^{2} = y_{4}-2y_{3}+y_{2}\\
2\times (0.5)^{2} = y_{5}-2y_{4}+y_{3}\\
2.5\times (0.5)^{2} = y_{6}-2y_{5}+y_{4}
$$

Yukarıdaki denklemleri matris şeklinde yazalım. Yazarken $y_{0}=1$ ve $y_{6}=9$ yazacağız.

\begin{align*}
-0.875 =& y_{2}-2y_{1}\\
0.25 =& y_{3}-2y_{2}+y_{1}\\
0.375 =& y_{4}-2y_{3}+y_{2}\\
0.5 =& y_{5}-2y_{4}+y_{3}\\
-8.375 =& -2y_{5}+y_{4}
\end{align*}

$$
\begin{bmatrix}
    -2 & 1 & 0 & 0 & 0\\
    1 & -2 & 1 & 0 & 0\\
    0 & 1 & -2 & 1 & 0\\
    0 & 0 & 1 & -2 & 1\\
    0 & 0 & 0 & 1 & -2\\
\end{bmatrix}
\begin{bmatrix}
    y_{1}\\
    y_{2}\\
    y_{3}\\
    y_{4}\\
    y_{5}\\
\end{bmatrix}=
\begin{bmatrix}
    -0.875\\
    0.25\\
    0.375\\
    0.5\\
    -8.375    
\end{bmatrix}
$$

Bu denklemi çözmeyi biliyoruz. Denklemi çözdüğümüzde $y_{1}, y_{2}, y_{3}, y_{4}, y_{5}$ değerlerini bulmuş oluruz.

### Çözüm Kod

```{python}
import numpy as np
from scipy.linalg import solve
import matplotlib.pyplot as plt

coefMat= np.array([\
      [-2, 1, 0, 0, 0]\
    , [ 1,-2, 1, 0, 0]\
    , [ 0, 1,-2, 1, 0]\
    , [ 0, 0, 1,-2, 1]\
    , [ 0, 0, 0, 1,-2]])
solMat= np.array([-0.875,0.25,0.375,0.5,-8.375])

solution=solve(coefMat, solMat)
y0= 1.
solution=np.insert(solution, 0, y0)
yEnd= 9.
solution=np.append(solution, yEnd)
x= np.linspace(0, 3, 7)

plt.plot(x, solution, 'o-')
# Analitik Çözüm
# y''= t y(0)=1 y(3)=9
# y'= t^2/2  + C1
# y= t^3/6  + C1 t + C2
# y(0)=1 => C2=1
# y(3)=9 => 9=27/6 + 3C1 + 1=9 => C1=27/18

#=> y(t)= t^3/6 + 21t/18 + 1

plt.plot(x, x**3/6 + 21*x/18 + 1, 'r-')
plt.show()

# --------------------------------------------
h=0.1
x2=np.linspace(0, 3, 31)
ilkDenklemSagTaraf=0.1*(0.1**2)-y0
sonDenklemSagTaraf=2.9*(0.1**2)-yEnd

araDenklemlerSagTaraf=np.array(ilkDenklemSagTaraf)
for i in range(27):
    araDenklemlerSagTaraf= np.append(araDenklemlerSagTaraf,x2[i+1]*(0.1**2))

araDenklemlerSagTaraf= np.append(araDenklemlerSagTaraf,sonDenklemSagTaraf)
# Coefficient Matrix
coefMat2= np.zeros((29, 29))

for i in range(29):
    coefMat2[i, i]= -2
    if not i == 28:
        coefMat2[i, i+1]= 1
    if not i == 0:
        coefMat2[i, i-1]= 1

solution2=solve(coefMat2, araDenklemlerSagTaraf)
solution2=np.insert(solution2, 0, y0)
solution2=np.append(solution2, yEnd)

plt.plot(x2, solution2, 'o-')
plt.show()
# --------------------------------------------
```

## Sonlu Farklar Yönteminin Çalışmadığı Örnek

Eğer oluşturduğumuz diferansiyel denklem sistemi doğrusal değilse, yukarıdaki algoritmayı kullanmayız. Aşağıdaki örneği inceleyelim.

$$
y''(t)=tyy'(t)
$$

Çözmemiz gereken denklem

$$
y''(t)=tyy'(t)=\frac{y_{i+1}-2y_{i}+y_{i-1}}{h^2}
$$

$i=1$ için yazalım.

$$
ty_{1}y_{1}'=\frac{y_{2}-2y_{1}+y_{0}}{h^2}
$$

Türevi de açıkça yazalım.

$$
ty_{1} \frac{y_{2}-y_{0}}{2h}=\frac{y_{2}-2y_{1}+y_{0}}{h^2}
$$

Düzenleyelim.

$$
\frac{th}{2} (y_{1}y_{2}-y_{1}y_{0}) -y_{2}+2y_{1}-y_{0} = 0
$$

$y_{1}y_{2}$ gibi terimlerin varlığından dolayı bu denklem doğrusal olmayan (nonlineer) denklemdir. Klasik yöntemlerle (LU ayrıştırma veya Gauss eleme) çözülemez.

## Problemler

### Problem 1

Aşağıdaki diferansiyel denklemi sonlu farklar yöntemini kullanarak $h=0.1$ için adım adım çözün.

$$
y''(t) + t y'(t) + y = 2t^{2}, \quad y(0)=1, \quad y(0.8)=1
$$

### Problem 2

Aşağıdaki diferansiyel denklemi sonlu farklar yöntemini kullanarak $h=0.2$ için adım adım çözün. Bu çözümü atış metodu ile de çözün. Sonuçları karşılaştırın.

$$
\frac{\hbar^{2}}{2 m}\frac{d^{2}}{dx^{2}}\psi(x) = E\psi(x), \qquad \psi(x=0)=0, \qquad \psi(x=L)=0 \text{.}
$$

Çözümü $n=1$ ve $n=2$ için çizdirin. Uygun $L$ değerini siz belirleyin.

Buradaki katsayılar:

1. $\hbar=1.1\times 10^{-34}$ J $\times$ s
2. $m=9.1\times 10^{-31}$ kg
3. $E=\frac{\pi^{2}\hbar^{2}}{2mL^{2}}n^{2}$ J.

Analitik Çözüm: 

$$
\psi(x)=\sqrt{\frac{2}{L}}\sin\left(\frac{n\pi x}{L}\right)
$$

## Kaynaklar

1. Numerical Methods in Engineering with Python 3, Jaan Kiusalaas, Cambridge University Press, 2013, **Syf:307**
2. [Sonlu Farklar Yöntemi, Youtube Videosu](https://www.youtube.com/watch?v=-RK5r65OF-Y)
3. [Numerical Solutions of Schrodinger’s Equation, Neill Lambert, 2001](https://www1.itp.tu-berlin.de/brandes/public_html/qm/qv3.pdf)